/*!
 * file-uploader - jQuery file upload plugin
 * v0.5.0
 * https://github.com/jgallen23/file-uploader/
 * copyright First + Third 2015
 * MIT License
*/
!function(a){a.declare("imageUploader",{defaults:{action:window.location.href,method:"POST",postKey:"image",progressTemplate:'<div class="progress">Uploading...</div>',completeTemplateImage:"<img/>",completeTemplateOther:"<p>The file has been uploaded &#x2714;</p>",images:["jpg","png","bmp","gif","jpeg"],allow:[],processData:null,zIndex:2,dropZone:"this",updateProgress:function(){}},init:function(){this.supportsFileApi="undefined"!=typeof window.FileReader,this.el.css("cursor","pointer"),this.setupFramejax(),this.supportsFileApi&&this.setupFileApi()},setupFramejax:function(){var b=this,c=a("<form/>").attr({action:this.action,method:this.method,enctype:"multipart/form-data"}).appendTo("body"),d=a("<input/>").attr({name:this.postKey,type:"file"}).css({opacity:"0",cursor:"pointer",position:"absolute",zIndex:this.zIndex}).on("change",function(a){var d=a.target.value;return this.checkType(d)?(b.el.trigger("fileSelect"),b.showProgress(),void c.submit()):void alert("Please select a file with a "+b.allow.join(", ")+" extension")}).appendTo(c);this.el.on("mousemove",function(a){var b=d.height(),c=d.width();"undefined"==typeof a.pageY&&"number"==typeof a.clientX&&document.documentElement&&(a.pageX=a.clientX+document.documentElement.scrollLeft,a.pageY=a.clientY+document.documentElement.scrollTop),d.css({top:a.pageY-b/2,left:a.pageX-(c-30)})}),c.framejax().on("complete",function(a,c){b.showComplete(c),b.el.trigger("complete",c)})},checkType:function(b){return!this.allow.length||-1!==a.inArray(this.getExtension(b),this.allow)},setupFileApi:function(){var b=this;b.dropZone="this"===b.dropZone?b.el:a(b.dropZone),b.dropZone.bind("dragenter, dragover",function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy",b.emit("over")}),b.dropZone.bind("dragleave",function(){b.emit("out")}),b.dropZone.bind("drop",function(a){a.stopPropagation(),a.preventDefault();var c=a.originalEvent.dataTransfer.files[0];b.checkType(c.name)&&b.upload(c)})},showProgress:function(){this.el.html(this.progressTemplate)},getExtension:function(a){return a.split(".").pop().toLowerCase()},showComplete:function(b){var c=this.getExtension(b),d=this.processData?this.processData(b):b,e=a.inArray(c,this.images)>-1;d&&(e?this.el.html(this.completeTemplateImage).find("img").attr("src",d):this.el.html(this.completeTemplateOther))},upload:function(a){var b=new FormData,c=this,d=new XMLHttpRequest;b.append("image",a),c.showProgress(),d.open("POST",c.action,!0),d.upload.onprogress=c.updateProgress,d.onload=function(a){c.showComplete(this.responseText,this,a),c.el.trigger("complete",this.responseText)},d.send(b)}})}(window.jQuery);